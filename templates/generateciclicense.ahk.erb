#NoEnv
SendMode Input
SetWorkingDir %A_ScriptDir%

SimplePing(URL, timeout = 1000)
{
  Runwait, %comspec% /c ping -w %timeout% %url%>ping.log,,hide
  fileread , StrTemp, ping.log
  filedelete, ping.log
  if RegExMatch(StrTemp, "Average = (\d+)", result)
    return result1
  else
    return "No response."
}

if SimplePing("licgenwebserv") <> "No response."
{
  RunWait, %comspec% /c C:\ProgramData\PuppetLabs\puppet\etc\modules\cicserver\files\licensing\LicGenClient\LicGenClient.exe -hostid %clipboard% -hostname %A_ComputerName% -version 4 -fulllic 1000,,hide
  FileMove, %A_ComputerName%.I3Lic, %A_Desktop%\License.I3Lic, 1
}
else
{
  Exit, -1 ; Can't reach license server (licgenwebserv)
}
